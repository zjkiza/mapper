# Instructions for setting up DTO and Entity to work with the mapper.

## Settings on the entity

1. Symfony entities must implement interface `Zjk\DtoMapper\Contract\IdentifierInterface`.
2. With entities, the id must be created via the constructor.
   Example:
  ```php
  use Zjk\DtoMapper\Contract\IdentifierInterface;
  ...  
  class User implements IdentifierInterface
  {
      ...
      #[ORM\Id]
      #[ORM\GeneratedValue(strategy: 'NONE')]
      #[ORM\Column(type: 'uuid', unique: true)]
      private UuidInterface $id;
      
      public function __construct(?UuidInterface $id = null)
      {
        $this->id = $id ?? Uuid::uuid4();
      }
     
      public function getIdentifier(): int|string
      {
        return $this->id->toString();
      }
     ...
  }
  ```

## Configuration of DTO objects.

- It is mandatory to define an attribute for the entity on the class.
  ```php
  #[Entity(name: Post::class)]
  class PostDto
  {...}
  ```
- When a new entity is passed through a Dto object, it is recommended to use attribute `Zjk\DtoMapper\Attribute\NewEntity` above the DTO object. The mapper is then fast, because it will not waste time to check if that entity exists, but will create it immediately.
  Example:
  ```php
  #[Entity(name: Post::class)]
  #[NewEntity]
  class PostDto
  {...}
  ```
- If you have an ID property, it is mandatory to define `#[Identifier]`.
  Example:
  ```php
    #[Zjk\DtoMapper\Attribute\Identifier()]
    public ?string $id = null;  
   ```
- You define those property that you want to map from entity to Dto.
    - There we have two variants, the name from the entity can be called the same as the name in dto. What will mean by default. mapper will by default use setter and getter generated by default.
      set + parameter name , get + parameter name. example:
      ```php
      public ?string $title = null; 
      ```  
      They will use it : `getTitle` and `setTitle`

    - If the name from the DTO property is not mapped to the name of the entity, then it is necessary to define the setter and getter attributes on the property.
      Example:
      ```php
      #[Zjk\DtoMapper\Attribute\Getter(methodName: 'getTitle')]
      #[Zjk\DtoMapper\Attribute\Setter(methodName: 'setTitle')]
      public ?string $titleRequest = null; 
      ```  

- For a property that is not mapped from entity to Dto and exists defined in Dto because we use it for something else, it should be ignored.
  Example:
  ```php
  #[Zjk\DtoMapper\Attribute\Ignore]
  public ?string $location = null;
  ```  

- For direct mapping to another object, we use the DTO attribute
  Example:
  ```php
  #[Zjk\DtoMapper\Attribute\Dto(className: UserDto::class)]
  public ?UserDto $user = null;
  ```
  The User object will map to UserDto.

- You can perform the transformation of the input as well as the output value of the parameter.
  Example: We want to enter an id which is an uuid, but we send it as an input string, and we need to transform it into an entity into a UUD object. We will use transform `UuidTransformer`
  ```php
  #[Zjk\DtoMapper\Attribute\Transformer(name: Zjk\DtoMapper\Transformer\UuidTransformer::class)]
  public ?string $id = null;
  ```
  Notice : You can create your own transformer, you just need to create a new transformer that implements the interface `Zjk\DtoMapper\Contract\DataTransformerInterface` and define it as a service. You call ka with the class name.
  Example:
  ```php
  Class MyTransformer implements Zjk\DtoMapper\Contract\DataTransformerInterface
  {
     public function transform(mixed $value): mixed
     {
       // your code
     }   
  
     public function reverse(mixed $value): mixed
     {
          // your code
     }
  }
  ```
  And the call in your DTO would be
  ```php

  #[Zjk\DtoMapper\Attribute\Transformer(name: MyTransformer::class)]
  public ?string $name = null;
  ```

    An example of how it looks in DTO:
    ```php
    #[Entity(name: Post::class)]
    class PostDto
    {
        #[Identifier]
        #[Transformer(name: UuidTransformer::class)]
        public ?string $id = null;
        
        public ?string $title = null;
        
        #[Getter(methodName: 'getDescription')]
        #[Setter(methodName: 'setDescription')]
        public ?string $descriptionRequest = null;
    
        #[Dto(className: UserDto::class)]
        public ?UserDto $user = null;
        
        #[Ignore]
        public ?string $location = null;
    }
    ```

## Entity to DTO
- For collections of entities on the property, it is necessary to set a Collection with the name of the DTO class in which the structure of that data is given.
  Example:
  ```php
  #[Entity(name: Post::class)]
  class PostDto
  {
    ...  
    #[Collection(className: CommentDto::class)]
    public ?array comments = null;
    ...
  }
  
    #[Entity(name: Comment::class)]
  class CommentDto 
  {
    public ?string $description = null;
  }
  ```

- Notice : If you need an ID, and it is of object type, it will be faster to use `#[Getter(methodName: 'getIdentifier')]`, than transform.
  Example:
  ```php
    #[Getter(methodName: 'getIdentifier')]
    public ?string $id = null;
  ```

## DTO to Entity

- Create separate DTO classes for creating and editing entities, for good practice.
- ID property must be defined wit attributes `#[Identifier]`.
- Only when you create a new entity, you want to pass the ID, not the constructor to generate it. At the same time, you have different types of properties in the DTO is a string and the entity is a UUID, it is necessary to define the necessary transformer on the DOT id property.
  ```php
    #[Zjk\DtoMapper\Attribute\Identifier()]
    #[Zjk\DtoMapper\Attribute\Transformer(UuidTransformer::class)]
    public ?string $id = null;  
   ```

- When you edit an entity, be sure to check whether the entity id already exists in the database, otherwise if you pass an id that is not in the database, the mapper will try to create a new entity with the default values.
- For relations, we add the attribute `Zjk\DtoMapper\Attribute\RepositoryClass` and property `entityClassName`, `addMethod`, `removeMethod` - are required. There we have two ways of setting:

    -  For a strong object, where the relation entity is created independently, the property onlyRelation should be set to True.
       Example:
    ```php
    #[RepositoryClass(
        entityClassName: Expert::class,
        addMethod: 'addExpert',
        removeMethod: 'removeExpert',
        onlyRelation: true,
    )]
    #[Collection(className: ExpertDto::class)]
    public ?array $expert = null;
    ```

    - For weak object, when they are created and updated via relation, property `onlyRelation` is false which is assumed by default and does not need to be defined.   
      Example:
  ```php
    #[RepositoryClass(
        entityClassName: Image::class,
        addMethod: 'addImage',
        removeMethod: 'removeImage',
    )]
    #[Collection(className: ImageDto::class)]
    public ?array $image = null;
  ```
  Full example:
  ```php
  #[Entity(name: Post::class)]
  class PostDto
  {
        #[Identifier]
        #[Getter(methodName: 'getIdentifier')]
        public ?string $id = null;
  
        public ?string $title = null;
      
        public ?string $descriptionRequest = null; 
  
        #[Dto(className: UserDto::class)]
        public ?UserDto $user = null;
      
        #[RepositoryClass(
           entityClassName: Expert::class,
           addMethod: 'addExpert',
           removeMethod: 'removeExpert',
           onlyRelation: true,
        )]
        #[Collection(className: ExpertDto::class)]
        public ?array $expert = null;
  
        #[RepositoryClass(
            entityClassName: Image::class,
            addMethod: 'addImage',
            removeMethod: 'removeImage',
        )]
        #[Collection(className: ImageDto::class)]
        public ?array $image = null;
  
        #[Ignore]
        public ?string $location = null; 
  }
  ```
**Notice:** when we finish mapping Dto to Entity, it is necessary to perform recording in the database with
```php
Doctrine\ORM\EntityManagerInterface->flush();
```

Example:
```php
$post = Zjk\DtoMapper\Contract\MapperInterface->fromObjectDtoToEntity($postDto, Post::class);
Doctrine\ORM\EntityManagerInterface->flush();
```